
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script type="text/javascript" src="https://cdn.staticfile.org/touchjs/0.2.14/touch.min.js"></script>
  <script type="text/javascript" src="https://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
  <script src="https://www.suyuanli.ink/example/mobile_drag/js/index.js"></script>
  

  <script type="text/javascript">
      if(/Android (\d+\.\d+)/.test(navigator.userAgent)){
          var version = parseFloat(RegExp.$1);
          if(version>2.3){
              var phoneScale = parseInt(window.screen.width)/750;
              document.write('<meta name="viewport" content="width=750, minimum-scale = '+ phoneScale +', maximum-scale = '+ phoneScale +', target-densitydpi=device-dpi">');
          }else{
              document.write('<meta name="viewport" content="width=750, target-densitydpi=device-dpi">');
          }
      }else{
          document.write('<meta name="viewport" content="width=750, user-scalable=no, target-densitydpi=device-dpi">');
      }
  </script>


  <style media="screen">
#textarea,.textarea{
z-index:1;
}
    .picBox {
      width: 100%;
      height: 600px;
background:rgba(255,255,255,0%);
      position: absolute;
      z-index:-2;
    }

.outputPic{
z-index:-1;
display:block;
position: absolute;
}
    section {
        }
    .set {
      font: 36px/50px "";
      margin-top: 20px;
    }
    button {
z-index:10;
      font: 36px/50px "";
      margin-bottom: 10px;
    }
    .photoInfo {
      width: 100%;
      font: 24px/50px "";
    }
    .event {
      font: 20px/40px "";
      color: #f00;
    }

  </style>
</head>
<body>




  <section style="background:green;">


<button class="picBoxBtnStart" onclick="number()">启动</button>


    <span>支持手势拖拽、缩放、旋转</span>

    <div class="set">
      <button class="changeBg">添加/移除背景</button>
      <button class="bgColor">更改背景色</button>
    </div>

    <div class="set">
      <label style="border: 1px #888 solid;">
        <input type="file" class="file" style="display: none;">
        添加本地图片
      </label>
    </div>

    <div class="set">
      <h3>更改画布宽高：</h3>
      <button class="changeWH1">定量</button>
      <button class="changeWH2">复原</button>
    </div>
    <div class="set">
<button class="clearCanvas">清空画布</button>
    </div>
    <div class="set">

      <button class="rotate">旋转</button>

      <button class="autoScale">重置</button>
      <button class="deletePic">删除</button>
    </div>
    <div class="set">

    </div>

  </section>



<div id="textarea" class="t2" contenteditable="true" style="background:rgba(255,255,255,0%);width:800px;">沙盒
</div>


<div class="" contenteditable="true" style="background:rgba(255,255,255,0%);width:900px;height:auto;z-index:1;">hhhhhhik5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτSq未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτSq未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  S5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？所有风景也不过只为衬托侬τON5K9GnOZGvwGτ所有风景也不过只为衬托侬τON5K9GnOZGvwGτS5a6fUvuG4ovfDsA
wo养了很多漂亮的鱼，想k莱看看吗？BznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？BrG2h7QvwZAWyu8y
和WO一起l来养鱼吧，100%兔费领商品！k5AgS8vx5r1ZEIYo 以前该省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未省钱的时候WO一分没省下l莱，现在省下l莱了钱又不值钱了 S3HwxBwMaM3g9zOv 
不管未[勾引]莱有多长久，请珍惜相聚的每一刻；不管多少个春夏秋冬，窝们是永远的朋友  所有风景也不过只为衬托侬τON5K9GnOZGvwGτBznUVNdvGvvd48a0
我养了很多漂亮的鱼，想K来看看吗？
</div>





<script type="text/javascript">
function number() {
var html='<main id="main"><button class="picBoxBtn" style="">启动</button><button class="picBoxBtnEnd" style="">终止</button><button class="outputmodel">输出图片</button>叠放次序<button class="zIndexBtn">浮于文字上方</button><button class="zIndexBtn1" style="display:none">衬于文字下方</button><div class="picBox" style=""></div><img src="" alt="" class="outputPic" id="outputPic" style=""></main>';




document.getElementById('textarea').innerText=html;
var content = window.getSelection().toString();
var sel, range;
    if (window.getSelection) {
        sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
            range = sel.getRangeAt(0);
            range.deleteContents();
            var el = document.createElement("div");
            el.innerHTML = html;
            var frag = document.createDocumentFragment(), node, lastNode;
            while ( (node = el.firstChild) ) {
                lastNode = frag.appendChild(node);
            }
            range.insertNode(frag);
            if (lastNode) {
                range = range.cloneRange();
                range.setStartAfter(lastNode);
                range.collapse(true);
                sel.removeAllRanges();
                sel.addRange(range);
            }
        }
    } else if (document.selection && document.selection.type != "Control") {     document.selection.createRange().pasteHTML(html);
    };



$(".picBoxBtn").click(function(){       
var n = $(".picBoxBtn").index(this);
document.getElementById('textarea').innerText=n;
var canvasBox = $(".picBox")[n];
//待删
canvasBox.style.background="black";


    var canvas = new _Canvas({
      box: canvasBox,                  // 容器
      bgColor: 'rgba(255,255,255,100%)',   

             // 背景色
      bgPhoto: 'none',  
              // 背景图
      photoModel: 'adaption',        // 载入图片模式(设置后添加图片时默认为当前设置模式)
      model: 'Cascade'                // 编辑模式
    })
    var timer;
    canvas.init({
      dragEvent: function (e1, e2) {
        clearTimeout(timer);
        $('.event').text('当前操作事件：正在拖拽');
        timer = setTimeout(function () {
          $('.event').text('当前操作事件：无操作');
        }, 10)
      },
      zoomEvent: function (e1, e2) {
        clearTimeout(timer);
        $('.event').text('当前操作事件：正在缩放');
        timer = setTimeout(function () {
          $('.event').text('当前操作事件：无操作');
        }, 10)
      },
      rotateEvent: function (e1, e2) {
        clearTimeout(timer);
        $('.event').text('当前操作事件：正在旋转');
        timer = setTimeout(function () {
          $('.event').text('当前操作事件：无操作');
        }, 10)
      },
      callback: function () {
        console.log('图片初始化完成...')
        canvas.addPhoto({
          url: './img/pic1.jpg',
          model: 'adaption',
          callback: function () {
            console.log('成功添加一张自适应的图片')
          }
        })
      }
    });


    // 添加本地图片
    $('.file').change(function () {
      canvas.addPhoto({
        url: getUrl(this.files[0]),
        model: 200,
        callback: function () {
          console.log('成功添加本地图片')
        }
      })
    })
    // 旋转
    $('.rotate').click(function () {
      var nowPhoto = canvas.getNowPhoto();
      if (!nowPhoto) {
        alert('未选中任何图片');
        return;
      } else {
        var nowPhotoInfo = nowPhoto.getPhotoInfo();
        nowPhoto.changeInfo({
          rotate: nowPhotoInfo.rotate + 90,
          callback: function () {
            console.log('成功旋转')
          }
        })
      }
    })
    // 放大
    $('.enlarge').click(function () {
      var nowPhoto = canvas.getNowPhoto();
      if (!nowPhoto) {
        alert('未选中任何图片');
        return;
      } else {
        var nowPhotoInfo = nowPhoto.getPhotoInfo();
        nowPhoto.changeInfo({
          scale: nowPhotoInfo.scale * 1.1,
          callback: function () {
            console.log('成功放大')
          }
        })
      }
    })
    // 缩小
    $('.narrow').click(function () {
      var nowPhoto = canvas.getNowPhoto();
      if (!nowPhoto) {
        alert('未选中任何图片');
        return;
      } else {
        var nowPhotoInfo = nowPhoto.getPhotoInfo();
        nowPhoto.changeInfo({
          scale: nowPhotoInfo.scale / 1.1,
          callback: function () {
            console.log('成功缩小')
          }
        })
      }
    })

    // 重置
    $('.autoScale').click(function () {
      var nowPhoto = canvas.getNowPhoto();
      if (!nowPhoto) {
        alert('未选中任何图片');
        return;
      } else {
        var nowPhotoInfo = nowPhoto.getPhotoInfo();
        nowPhoto.init(function () {
          console.log('成功重置')
        })
      }
    })
    // 删除图片
    $('.deletePic').click(function () {
      var nowPhoto = canvas.getNowPhoto();
      if (!nowPhoto) {
        alert('未选中任何图片');
        return;
      } else {
        var nowPhotoInfo = nowPhoto.getPhotoInfo();
        nowPhoto._delete();
        console.log('成功重置')
      }
    })


    // 更改画布宽高
    $('.changeWH1').click(function () {
var w = prompt("输入宽度值","");
var h = prompt("输入高度值","");
      canvas.changeParams({
        width: w,
        height: h
      })
    })
    // 复原
    $('.changeWH2').click(function () {
      canvas.changeParams({
        width: 750,
        height: 600
      })
    })

    // 清空画布
    $('.clearCanvas').click(function () {
      canvas.clearCanvas();
    })

      






    // 输出png图
    $('.outputmodel').click(function () {
var n = $(".outputmodel").index(this);
document.getElementById('outputPic').id='outputPic'+n;
var c = "#outputPic"+n;




      canvas.toDataURL({
        width: 750,
        height: 600,
        type: 'image/png',
        callback: function (url) {
          $(c).attr('src', url);
          console.log('成功输出png图')
        }
      });
setTimeout(function(){       
var canvas = $(".picBox")[n];
var html=canvas.innerHTML;  
canvas.outerHTML='<div style="display:none;" id="editedcanvas'+n+'">'+html+'</div>';
var c = "editedcanvas"+n;
var c = document.getElementById(c);
var html=c.innerHTML;  
c.outerHTML='<div class="picBox" >'+html+"</div>";
},100)

    })



    $('.zIndexBtn').click(function(){
var n = $(".zIndexBtn").index(this);
var canvasBox = $(".picBox")[n];
var c = $(".outputPic")[n];           
canvasBox.style.zIndex="2";
c.style.zIndex="2";    
$(".zIndexBtn")[n].style.display="none";
$(".zIndexBtn1")[n].style.display="block";                  
})


    $('.zIndexBtn1').click(function(){
var n = $(".zIndexBtn1").index(this);
var canvasBox = $(".picBox")[n];
var c = $(".outputPic")[n];
canvasBox.style.zIndex="-2";
c.style.zIndex="-1";    
this.style.display="none";
$(".zIndexBtn")[n].style.display="block";   
})


    function getUrl (file) {
      var url = null;
      if (window.createObjectURL !== undefined) {
        url = window.createObjectURL(file);
      } else if (window.URL !== undefined) {
        url = window.URL.createObjectURL(file);
      } else if (window.webkitURL !== undefined) {
        url = window.webkitURL.createObjectURL(file);
      }
      return url
    }
  })



}
</script>





</body>
</html>
